<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>jquery-table</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="jquery-table/jquery-table.css">
    <style>
        body{
            padding: 20px;
        }
    </style>
</head>
<body>
<table id="table"></table>
<button id="getChecked">获取被复选框选中的数据</button>
<button id="getCheckedIDs">获取被复选框选中的数据的ID</button>
<button id="getSelected">获取被选中的数据</button>
<button id="getSelectedIDs">获取被选中的数据的ID</button>
<button id="render">渲染数据</button>
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="jquery-table/jquery-table.js"></script>
<script src="data.js"></script>
<script>
    /*计划开始时间顺序一开始是降序*/
    var plannedStartTimeOrder="desc";
    $("#table").table({
        showNo:true,
        number:function(i){
            return i+1;
        },
        showCheckbox:true,
        select:true,
        singleSelect:true,
        rowEvents:{
            click:function(rowData,idx,e){
                console.log(this);
                console.log("click",arguments);
            },
            mousedown:function(rowData,idx,e){
                console.log("mousedown",arguments);
            }
        },
        datas:datas,
        columns:[{
            title:"任务编号",
            field:"taskno"
        },{
            title:"批次号",
            field:"batchno",
            formatter:function(value,rowData,rowIndex){
                return $("<span/>",{
                    "style":"color:#0d84d4",
                    "text":value
                })
            }
        },{
            title:"单位",
            field:"employer"
        },{
            title:function(field){
                return [
                    document.createTextNode("计划开始时间"),
                    $("<span/>",{
                        "class":function(){
                            var cls="glyphicon ";
                            cls+=plannedStartTimeOrder==="desc"?"glyphicon-triangle-top":"glyphicon-triangle-bottom";
                            return cls;
                        },
                        click:function(){
                            console.log("字段是:"+field);
                            /*这里可以请求ajax然后使用返回的数据渲染表格,这里setTimeout是模拟ajax异步*/
                            setTimeout(function(){
                                plannedStartTimeOrder=plannedStartTimeOrder==="desc"?"asc":"desc";
                                $("#table").table("setDatas",datas);
                            },100);
                        }
                    })
                ];
            },
            field:"plannedStartTime",
            formatter:function(value,rowData,rowIndex){
                if(!value){
                    return "- -"
                }
                var date=new Date(value);
                return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+date.getMinutes();
            }
        },{
            title:"实际开始时间",
            field:"startTime",
            formatter:function(value,rowData,rowIndex){
                if(!value){
                    return "- -"
                }
                var date=new Date(value);
                return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+date.getMinutes();
            }
        },{
            title:"实际结束时间",
            field:"endTime",
            formatter:function(value,rowData,rowIndex){
                if(!value){
                    return "- -"
                }
                var date=new Date(value);
                return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+date.getMinutes();
            }
        },{
            title:"执行状态",
            field:"status",
            formatter:function(value,rowData,rowIndex){
                switch (+value){
                    case -1:return "暂停执行";
                    case 0:return "未执行";
                    case 1:return "正在执行";
                    case 2:return "任务完成";
                }
                return "未知"
            }
        },{
            title:"执行结果",
            field:"result",
            formatter:function(value,rowData,rowIndex){
                if(!value||value=="0"){
                    return "- -";
                }
                return [
                    $("<a/>",{
                        "class":"btn btn-warning btn-xs",
                        "click":function(){
                            console.log(rowData);
                        }
                    }).append(
                        $("<span/>",{
                            "class":"glyphicon glyphicon-save"
                        }),
                        document.createTextNode("下载")
                    ),
                    $("<a/>",{
                        "class":"btn btn-success btn-xs"
                    }).append(
                        $("<span/>",{
                            "class":"glyphicon glyphicon-eye-open"
                        }),
                        document.createTextNode("查看")
                    )
                ]
            }
        }]
    });
    $("#getChecked").on("click",function(){
        console.log($("#table").table("getChecked"));
    });
    $("#getCheckedIDs").on("click",function(){
        console.log($("#table").table("getCheckedIDs"));
    });
    $("#getSelected").on("click",function(){
        console.log($("#table").table("getSelected"));
    });
    $("#getSelectedIDs").on("click",function(){
        console.log($("#table").table("getSelectedIDs"));
    });
    $("#render").on("click",function(){
        datas.shift();//这句话把000001的数据删除掉了
        datas.push({
            id:"000006",
            taskno:"201611006",
            batchno:"006",
            employer:"山东电力公司",
            plannedStartTime:new Date().toLocaleDateString(),
            startTime:new Date().toLocaleDateString(),
            endTime:new Date().toLocaleDateString(),
            status:"-1",
            result:"1"
        });
        $("#table").table("setDatas",datas);
        $("#table").table("check",["000005","000006"]);
    })
</script>
</body>
</html>